
> stayeasy-app@0.0.0 server
> tsx watch server/server.ts

[dotenv@17.2.3] injecting env (17) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops
â‰¡Æ’Ã¶Ã¬ [Supabase] URL: https://...e.co
â‰¡Æ’Ã¶Ã¬ [Supabase] Service key present: true
Î“Â£Ã  Supabase credentials loaded successfully
[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops
â‰¡Æ’ÃœÃ‡ StayEasy API Server running on port 3004
â‰¡Æ’Ã´â–’ Health check: http://localhost:3004/api/health
â‰¡Æ’Ã†Â¼ WebSocket chat service initialized
â‰¡Æ’Ã¶Âº Environment: development
â‰¡Æ’Ã´Â¥ [2025-12-01T20:00:00.988Z] POST /api/auth/signup
â‰¡Æ’Ã¶Ã‰ [AuthService.createUser] Creating user: {
  email: 'testuser1785003323@example.com',
  name: 'Test User',
  role: 'TENANT'
}
Î“Â£Ã  [AuthService.createUser] Users table accessible, sample columns: [
  'id',                 'email',
  'password',           'name',
  'role',               'bio',
  'mobile',             'image_id',
  'email_verified',     'email_token',
  'email_token_expiry', 'created_at',
  'updated_at',         'avatar_url',
  'metadata'
]
Î“Â£Ã  [AuthService.createUser] Password hashed, email token generated
Î“Â£Ã  [AuthService.createUser] User created successfully: b32fc820-efaa-4dc5-8d27-4e6e3640a9cf
â‰¡Æ’Ã„Â» [AuthService.createSession] Creating session for user: b32fc820-efaa-4dc5-8d27-4e6e3640a9cf
â‰¡Æ’Ã¶Ã‰ [AuthService.createSession] Generated tokens, inserting into sessions table
Î“Â£Ã  [AuthService.createSession] Session created using sessions table
Î“Â£Ã  [AuthService.createSession] Session created successfully
â‰¡Æ’Ã´Â¥ [2025-12-01T20:00:05.566Z] POST /api/messages
POST /messages request body: { content: 'Hello from new user', recipientId: 'owner1@example.com' }
Sender ID: b32fc820-efaa-4dc5-8d27-4e6e3640a9cf
Looking up recipient by email: owner1@example.com
Resolved recipient ID: user-owner-1
Finding/creating chat between b32fc820-efaa-4dc5-8d27-4e6e3640a9cf and user-owner-1
Creating new chat
Chat ID: cminkprp50001q0low391uj3e
Inserting message into Supabase
Supabase insert error: {
  code: '42501',
  details: null,
  hint: null,
  message: 'permission denied for table messages'
}
1:30:55 am [tsx] change in ./server\controllers\messagesController.ts Restarting...

node:internal/modules/run_main:123
    triggerUncaughtException(
    ^
Error [TransformError]: Transform failed with 1 error:
C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\server\controllers\messagesController.ts:274:6: ERROR: Expected "}" but found "error"
    at failureErrorWithLog (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:1467:15)
    at C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:736:50
    at responseCallbacks.<computed> (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:603:9)
    at handleIncomingPacket (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:658:12)
    at Socket.readFromStdout (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:581:7)
    at Socket.emit (node:events:518:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:189:23)

Node.js v22.17.1
c1:31:30 am [tsx] change in ./server\controllers\messagesController.ts Rerunning...
c[dotenv@17.2.3] injecting env (17) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops
â‰¡Æ’Ã¶Ã¬ [Supabase] URL: https://...e.co
â‰¡Æ’Ã¶Ã¬ [Supabase] Service key present: true
Î“Â£Ã  Supabase credentials loaded successfully
[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild
â‰¡Æ’ÃœÃ‡ StayEasy API Server running on port 3004
â‰¡Æ’Ã´â–’ Health check: http://localhost:3004/api/health
â‰¡Æ’Ã†Â¼ WebSocket chat service initialized
â‰¡Æ’Ã¶Âº Environment: development
1:34:11 am [tsx] change in ./server\controllers\messagesController.ts Restarting...

node:internal/modules/run_main:123
    triggerUncaughtException(
    ^
Error [TransformError]: Transform failed with 2 errors:
C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\server\controllers\messagesController.ts:18:6: ERROR: A return statement cannot be used here:
C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\server\controllers\messagesController.ts:39:38: ERROR: "await" can only be used inside an "async" function
    at failureErrorWithLog (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:1467:15)
    at C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:736:50
    at responseCallbacks.<computed> (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:603:9)
    at handleIncomingPacket (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:658:12)
    at Socket.readFromStdout (C:\Users\kunal\OneDrive\Desktop\dbms\stayeasy\node_modules\tsx\node_modules\esbuild\lib\main.js:581:7)
    at Socket.emit (node:events:518:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:189:23)

Node.js v22.17.1
c1:34:53 am [tsx] change in ./server\controllers\messagesController.ts Rerunning...
c[dotenv@17.2.3] injecting env (17) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }
â‰¡Æ’Ã¶Ã¬ [Supabase] URL: https://...e.co
â‰¡Æ’Ã¶Ã¬ [Supabase] Service key present: true
Î“Â£Ã  Supabase credentials loaded successfully
[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }
â‰¡Æ’ÃœÃ‡ StayEasy API Server running on port 3004
â‰¡Æ’Ã´â–’ Health check: http://localhost:3004/api/health
â‰¡Æ’Ã†Â¼ WebSocket chat service initialized
â‰¡Æ’Ã¶Âº Environment: development
