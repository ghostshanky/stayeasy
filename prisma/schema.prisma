// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  password          String
  name              String
  role              Role     @default(TENANT)
  bio               String?
  mobile            String?
  image_id          String?
  email_verified    Boolean  @default(false)
  email_token       String?
  email_token_expiry DateTime?
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  // Relations
  bookings          Booking[]
  reviews           Review[]
  chats             Chat[]
  messages          Message[]
  sessions          Session[]
  audit_logs        AuditLog[]
  notifications     Notification[]
  properties        Property[]

  @@map("users")
}

model Owner {
  id         String   @id @default(cuid())
  email      String   @unique
  password   String
  name       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  properties Property[]
  chats      Chat[]

  @@map("owners")
}

model Property {
  id             String   @id @default(cuid())
  owner_id       String
  title          String
  location       String
  description    String?
  price_per_night Float
  images         String[] @default([])
  rating         Float    @default(0)
  amenities      String[] @default([])
  tags           String[] @default([])
  capacity       Int
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  owner          Owner    @relation(fields: [owner_id], references: [id])
  user           User     @relation(fields: [owner_id], references: [id], map: "properties_user_id_fkey")
  property_details PropertyDetail[]
  bookings       Booking[]
  reviews        Review[]

  @@map("properties")
}

model PropertyDetail {
  id          String @id @default(cuid())
  property_id String
  amenity     String
  value       String

  // Relations
  property    Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@map("property_details")
}

model Booking {
  id          String         @id @default(cuid())
  user_id     String
  property_id String
  check_in    DateTime
  check_out   DateTime
  status      BookingStatus  @default(PENDING)
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt

  // Relations
  user        User           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  property    Property       @relation(fields: [property_id], references: [id], onDelete: Cascade)
  payments    Payment[]

  @@map("bookings")
}

model Review {
  id          String   @id @default(cuid())
  user_id     String
  property_id String
  rating      Int
  comment     String?
  created_at  DateTime @default(now())

  // Relations
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  property    Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model Payment {
  id         String         @id @default(cuid())
  booking_id String
  amount     Float
  status     PaymentStatus  @default(PENDING)
  created_at DateTime       @default(now())

  // Relations
  booking    Booking        @relation(fields: [booking_id], references: [id], onDelete: Cascade)
  invoices  Invoice[]

  @@map("payments")
}

model Invoice {
  id          String   @id @default(cuid())
  payment_id  String
  details     String
  created_at  DateTime @default(now())

  // Relations
  payment     Payment  @relation(fields: [payment_id], references: [id], onDelete: Cascade)

  @@map("invoices")
}

model Chat {
  id         String    @id @default(cuid())
  user_id    String
  owner_id   String
  created_at DateTime  @default(now())

  // Relations
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  owner      Owner     @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  messages   Message[]

  @@map("chats")
}

model Message {
  id            String   @id @default(cuid())
  chat_id       String
  sender_id     String
  recipient_id  String
  content       String
  sender_type   String   @default("USER")
  read_at       DateTime?
  created_at    DateTime @default(now())

  // Relations
  chat          Chat     @relation(fields: [chat_id], references: [id], onDelete: Cascade)
  sender        User     @relation(fields: [sender_id], references: [id], onDelete: Cascade)
  files         File[]

  @@map("messages")
}

model File {
  id          String   @id @default(cuid())
  message_id  String
  url         String
  type        String
  created_at  DateTime @default(now())

  // Relations
  message     Message  @relation(fields: [message_id], references: [id], onDelete: Cascade)

  @@map("files")
}

model Session {
  id         String   @id @default(cuid())
  user_id    String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())

  // Relations
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model AuditLog {
  id        String   @id @default(cuid())
  user_id   String?
  action    String
  details   String?
  created_at DateTime @default(now())

  // Relations
  user      User?    @relation(fields: [user_id], references: [id], onDelete: SetNull)

  @@map("audit_logs")
}

model Notification {
  id         String   @id @default(cuid())
  user_id    String
  message    String
  read       Boolean  @default(false)
  created_at DateTime @default(now())

  // Relations
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("notifications")
}

enum Role {
  TENANT
  OWNER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}
