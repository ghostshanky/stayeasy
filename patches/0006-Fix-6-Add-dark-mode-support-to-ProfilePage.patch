From f67323a750d0914933795eabe57fa9f062147094 Mon Sep 17 00:00:00 2001
From: ghostshanky <actofjoy00@gmail.com>
Date: Mon, 1 Dec 2025 13:33:34 +0530
Subject: [PATCH 06/19] Fix #6: Add dark mode support to ProfilePage

- Imported useDarkMode from DarkModeContext
- Added dark: variants to all Tailwind classes
- Added refreshUser() calls after avatar upload and profile save
- Avatar changes now propagate to auth context
- Profile page now respects dark theme setting
---
 client/src/pages/ProfilePage.tsx | 70 +++++++++++++++++++-------------
 1 file changed, 41 insertions(+), 29 deletions(-)

diff --git a/client/src/pages/ProfilePage.tsx b/client/src/pages/ProfilePage.tsx
index 82c74c3..72783f5 100644
--- a/client/src/pages/ProfilePage.tsx
+++ b/client/src/pages/ProfilePage.tsx
@@ -3,10 +3,12 @@
 import React, { useState, useEffect, useRef } from "react";
 import toast from "react-hot-toast";
 import { useAuth } from "../hooks/useAuth";
+import { useDarkMode } from "../contexts/DarkModeContext";
 import { supabase } from "../lib/supabase";
 
 export default function ProfilePage() {
-  const { user: authUser, isAuthenticated } = useAuth();
+  const { user: authUser, isAuthenticated, refreshUser } = useAuth();
+  const { darkMode } = useDarkMode();
   const [user, setUser] = useState<any>(null);
   const [profileName, setProfileName] = useState("");
   const [bio, setBio] = useState("");
@@ -101,7 +103,7 @@ export default function ProfilePage() {
       // Upload to Supabase storage
       const fileExt = file.name.split('.').pop();
       const fileName = `${authUser.id}-${Date.now()}.${fileExt}`;
-      
+
       const { error: uploadError } = await supabase.storage
         .from('profiles')
         .upload(fileName, file);
@@ -128,6 +130,11 @@ export default function ProfilePage() {
       setImageId(publicUrl);
       toast.success("Profile image uploaded successfully");
 
+      // Refresh user context to propagate avatar
+      if (refreshUser) {
+        await refreshUser();
+      }
+
       // Clean up local preview
       if (localPreview) {
         URL.revokeObjectURL(localPreview);
@@ -141,7 +148,7 @@ export default function ProfilePage() {
       // For development, use a placeholder image
       setImageId(`https://via.placeholder.com/200x200?text=${authUser.name?.charAt(0) || 'U'}`);
       toast.success("Profile image updated (placeholder)");
-      
+
       setUploading(false);
       setUploadProgress(0);
     }
@@ -171,7 +178,7 @@ export default function ProfilePage() {
         image_id: imageId.startsWith('http') ? imageId : imageId,
         updated_at: new Date().toISOString(),
       };
-      
+
       const { error } = await supabase
         .from('profiles')
         .update(updates)
@@ -180,9 +187,14 @@ export default function ProfilePage() {
       if (error) {
         throw error;
       }
-      
+
       toast.success("Profile updated");
 
+      // Refresh user context to propagate changes
+      if (refreshUser) {
+        await refreshUser();
+      }
+
       // Refetch user data to reflect changes
       const { data: profile, error: fetchError } = await supabase
         .from('profiles')
@@ -211,25 +223,25 @@ export default function ProfilePage() {
   const displayImage = localPreview
     ? localPreview
     : imageId
-    ? (imageId.startsWith('http') ? imageId : imageId)
-    : "/default_profile_pic.jpg";
+      ? (imageId.startsWith('http') ? imageId : imageId)
+      : "/default_profile_pic.jpg";
 
   if (loading) {
     return (
-      <div className="max-w-3xl mx-auto mt-10 bg-white rounded-2xl shadow-lg p-8 md:p-10">
+      <div className="max-w-3xl mx-auto mt-10 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 md:p-10">
         <div className="text-center">
-          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
-          <p className="mt-4 text-gray-600">Loading profile...</p>
+          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 dark:border-blue-400 mx-auto"></div>
+          <p className="mt-4 text-gray-600 dark:text-gray-400">Loading profile...</p>
         </div>
       </div>
     );
   }
 
   return (
-    <div className="max-w-3xl mx-auto mt-10 bg-white rounded-2xl shadow-lg p-8 md:p-10">
+    <div className="max-w-3xl mx-auto mt-10 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 md:p-10">
       <div className="text-center mb-8">
-        <h1 className="text-3xl font-bold text-gray-800">My Profile</h1>
-        <p className="text-gray-500 text-sm">Manage your account details and preferences</p>
+        <h1 className="text-3xl font-bold text-gray-800 dark:text-white">My Profile</h1>
+        <p className="text-gray-500 dark:text-gray-400 text-sm">Manage your account details and preferences</p>
       </div>
 
       <div className="flex flex-col items-center space-y-4">
@@ -237,15 +249,15 @@ export default function ProfilePage() {
           <img
             src={displayImage}
             alt="Profile"
-            className="w-40 h-40 rounded-full object-cover border-4 border-gray-300 shadow-md transition-transform group-hover:scale-105"
+            className="w-40 h-40 rounded-full object-cover border-4 border-gray-300 dark:border-gray-600 shadow-md transition-transform group-hover:scale-105"
           />
           <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 rounded-full flex items-center justify-center transition-all pointer-events-none">
             <p className="text-white text-sm">Change Photo</p>
           </div>
           {uploading && (
-            <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/70 rounded-full">
+            <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/70 dark:bg-gray-800/70 rounded-full">
               <div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
-              <p className="text-sm text-gray-700">{Math.round(uploadProgress)}%</p>
+              <p className="text-sm text-gray-700 dark:text-gray-300">{Math.round(uploadProgress)}%</p>
             </div>
           )}
         </div>
@@ -254,7 +266,7 @@ export default function ProfilePage() {
 
         <label
           htmlFor="file-input"
-          className="inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm cursor-pointer hover:bg-blue-700 transition"
+          className="inline-flex items-center gap-2 bg-blue-600 dark:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm cursor-pointer hover:bg-blue-700 dark:hover:bg-blue-600 transition"
         >
           {uploading ? "Uploading..." : "Upload New Photo"}
           <input
@@ -271,59 +283,59 @@ export default function ProfilePage() {
         </label>
       </div>
 
-      <div className="mt-8 border-t border-gray-200"></div>
+      <div className="mt-8 border-t border-gray-200 dark:border-gray-700"></div>
 
       <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
         <div>
-          <label className="block text-sm font-medium text-gray-600">Full Name</label>
+          <label className="block text-sm font-medium text-gray-600 dark:text-gray-300">Full Name</label>
           <input
             type="text"
             value={profileName}
             onChange={(e) => setProfileName(e.target.value)}
-            className="mt-1 w-full border rounded-md p-2 focus:ring-2 focus:ring-blue-500"
+            className="mt-1 w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
             placeholder="Enter your full name"
           />
         </div>
 
         <div>
-          <label className="block text-sm font-medium text-gray-600">Email Address</label>
+          <label className="block text-sm font-medium text-gray-600 dark:text-gray-300">Email Address</label>
           <input
             type="email"
             value={email}
             disabled
-            className="mt-1 w-full border rounded-md p-2 bg-gray-100 text-gray-500"
+            className="mt-1 w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-gray-100 dark:bg-gray-900 text-gray-500 dark:text-gray-400"
           />
         </div>
 
         <div>
-          <label className="block text-sm font-medium text-gray-600">Mobile Number</label>
+          <label className="block text-sm font-medium text-gray-600 dark:text-gray-300">Mobile Number</label>
           <input
             type="tel"
             value={mobile}
             onChange={(e) => setMobile(e.target.value)}
             placeholder="Enter your phone number"
-            className="mt-1 w-full border rounded-md p-2 focus:ring-2 focus:ring-blue-500"
+            className="mt-1 w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
           />
         </div>
 
         <div>
-          <label className="block text-sm font-medium text-gray-600">Role</label>
+          <label className="block text-sm font-medium text-gray-600 dark:text-gray-300">Role</label>
           <input
             type="text"
             value={role}
             disabled
-            className="mt-1 w-full border rounded-md p-2 bg-gray-100 text-gray-500"
+            className="mt-1 w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-gray-100 dark:bg-gray-900 text-gray-500 dark:text-gray-400"
           />
         </div>
 
         <div className="md:col-span-2">
-          <label className="block text-sm font-medium text-gray-600">Bio</label>
+          <label className="block text-sm font-medium text-gray-600 dark:text-gray-300">Bio</label>
           <textarea
             rows={3}
             value={bio}
             onChange={(e) => setBio(e.target.value)}
             placeholder="Tell us something about yourself..."
-            className="mt-1 w-full border rounded-md p-2 focus:ring-2 focus:ring-blue-500"
+            className="mt-1 w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
           />
         </div>
       </div>
@@ -332,7 +344,7 @@ export default function ProfilePage() {
         <button
           onClick={handleSave}
           disabled={saving}
-          className="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2.5 rounded-md shadow-md transition-all disabled:opacity-60"
+          className="bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600 text-white font-semibold px-6 py-2.5 rounded-md shadow-md transition-all disabled:opacity-60"
         >
           {saving ? "Saving..." : "Save Changes"}
         </button>
-- 
2.51.0.windows.1

